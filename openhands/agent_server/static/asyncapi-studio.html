<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AsyncAPI Documentation - OpenHands Agent Server</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .header h1 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 600;
        }
        .header p {
            margin: 0.5rem 0 0 0;
            opacity: 0.9;
            font-size: 0.9rem;
        }
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            font-size: 1.1rem;
            color: #666;
        }
        .error {
            background: #fee;
            border: 1px solid #fcc;
            color: #c33;
            padding: 1rem;
            margin: 1rem;
            border-radius: 4px;
        }
        .studio-container {
            height: calc(100vh - 120px);
            border: none;
            width: 100%;
        }
        .links {
            padding: 1rem 2rem;
            background: white;
            border-bottom: 1px solid #eee;
        }
        .links a {
            color: #667eea;
            text-decoration: none;
            margin-right: 1rem;
            font-size: 0.9rem;
        }
        .links a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>AsyncAPI Documentation</h1>
        <p>WebSocket API documentation for OpenHands Agent Server</p>
    </div>
    
    <div class="links">
        <a href="/asyncapi/asyncapi.json" target="_blank">üìÑ JSON Schema</a>
        <a href="/asyncapi/asyncapi.yaml" target="_blank">üìÑ YAML Schema</a>
        <a href="/docs" target="_blank">üìö REST API Docs</a>
        <a href="/" target="_blank">üè† Server Info</a>
    </div>

    <div id="loading" class="loading">
        Loading AsyncAPI Studio...
    </div>
    
    <div id="error" class="error" style="display: none;">
        <strong>Error loading AsyncAPI Studio:</strong>
        <p id="error-message"></p>
        <p>You can still access the schema directly:</p>
        <ul>
            <li><a href="/asyncapi/asyncapi.json">JSON Schema</a></li>
            <li><a href="/asyncapi/asyncapi.yaml">YAML Schema</a></li>
        </ul>
    </div>

    <iframe 
        id="studio-frame" 
        class="studio-container" 
        style="display: none;"
        title="AsyncAPI Studio">
    </iframe>

    <script>
        // Get the current host and protocol for the schema URL
        const schemaUrl = `${window.location.protocol}//${window.location.host}/asyncapi/asyncapi.json`;
        
        // AsyncAPI Studio URL with our schema pre-loaded
        const studioUrl = `https://studio.asyncapi.com/?url=${encodeURIComponent(schemaUrl)}`;
        
        const loadingDiv = document.getElementById('loading');
        const errorDiv = document.getElementById('error');
        const errorMessage = document.getElementById('error-message');
        const studioFrame = document.getElementById('studio-frame');
        
        // Function to show error
        function showError(message) {
            loadingDiv.style.display = 'none';
            errorMessage.textContent = message;
            errorDiv.style.display = 'block';
        }
        
        // Function to load the studio
        function loadStudio() {
            try {
                studioFrame.src = studioUrl;
                
                // Handle iframe load
                studioFrame.onload = function() {
                    loadingDiv.style.display = 'none';
                    studioFrame.style.display = 'block';
                };
                
                // Handle iframe error
                studioFrame.onerror = function() {
                    showError('Failed to load AsyncAPI Studio. Please check your internet connection.');
                };
                
                // Timeout fallback
                setTimeout(() => {
                    if (studioFrame.style.display === 'none') {
                        showError('AsyncAPI Studio is taking too long to load. Please try refreshing the page.');
                    }
                }, 10000);
                
            } catch (error) {
                showError(`Failed to initialize AsyncAPI Studio: ${error.message}`);
            }
        }
        
        // Test if our schema is accessible first
        fetch('/asyncapi/asyncapi.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Schema not available (${response.status})`);
                }
                return response.json();
            })
            .then(schema => {
                // Schema is available, load the studio
                loadStudio();
            })
            .catch(error => {
                showError(`Cannot load AsyncAPI schema: ${error.message}`);
            });
    </script>
</body>
</html>