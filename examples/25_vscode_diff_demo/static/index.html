<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>VS Code Diff Demo</title>
  </head>
  <body>
    <h1>VS Code Diff Demo</h1>
    <p>
      Click the button to open the embedded web VS Code (OpenVSCode Server). It will
      load the current workspace and you can use the SCM view to inspect diffs. In V1,
      this replaces any bespoke "Changes" viewer.
    </p>
    <button id="open">Open VS Code</button>
    <pre id="out"></pre>
    <script>
      const WORK1 = 'https://work-1-wwoowncqtgweeoos.prod-runtime.all-hands.dev:12000';
      const WORK2 = 'https://work-2-wwoowncqtgweeoos.prod-runtime.all-hands.dev:12001';
      document.getElementById('open').onclick = async () => {
        // Ask the server for a tokenized VS Code URL, using the public work-2 host/port
        const resp = await fetch(`/api/vscode/url?base_url=${encodeURIComponent(WORK2)}`);
        const data = await resp.json();
        document.getElementById('out').textContent = JSON.stringify(data, null, 2);
        if (data.url) {
          window.open(data.url, '_blank');
        }
      };
    </script>
  </body>
</html>
